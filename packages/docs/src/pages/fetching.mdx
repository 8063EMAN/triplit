import { Callout } from 'nextra-theme-docs';

# Fetching

## Fetch

Data can be fetched with a single request. The Triplit Client provides two methods `fetch` and `fetchOne` which will make a single request to your database. How that request interacts with the local database and remote database can be configured by setting proper [options](#fetch-options).

`fetch()` executes the specified query and returns a Map with entity ids as keys and the associated entities as values. For example:

```typescript
await client.insert('employees', { name: 'Philip J. Fry' }, 'Fry');
await client.insert('employees', { name: 'Turanga Leela' }, 'Leela');

const query = client.query('employees').build();
const result = await client.fetch(query, options); // Map<string, { name: string }>
```

`fetchOne()` queries for a single entity by its id and returns the entity if it is found or `undefined` if it is not. For example:

```typescript
await client.insert('employees', { name: 'Philip J. Fry' }, 'Fry');
await client.insert('employees', { name: 'Turanga Leela' }, 'Leela');

const fry = await client.fetchOne('employees', 'Fry', options); // { name: 'Philip J. Fry' }
const leela = await client.fetchOne('employees', 'Leela', options); // { name: 'Turanga Leela' }
const bender = await client.fetchOne('employees', 'Bender', options); // undefined
```

`fetchOne` is equivalent to building a query with the [entityId](/queries#entity-id) parameter and pulling out the proper result from the result set.

## Fetch options

Because a Triplit Client may be dealing with two databases (your local database and remote database), the exact nature of how you would like to query those is customizable.

If no options are provided, queries will be fulfilled with the options `{ policy: 'local-first' }`.

### Policy

The `policy` option determines how you interact with your local and remote databases.

<Callout type="info" emoji="ℹ️">
  This is distinct from the [syncState](/queries#sync-state) parameter on a
  query, which indicates how you wish to query your local database.
</Callout>

The following policy types are valid:

- `local-first`: (default) This policy will fetch data directly from the local database, however if is determined that the query cannot be fulfilled it will fetch data from the remote database. If the remote database fails to fulfill the query, the cached data is used.
- `local-only`: This policy will fetch data directly from the local database and will never go to the network.
- `remote-first`: This policy will fetch data from the remote database and update the local database with those results before querying the local database.
- `remote-only`: This policy will fetch data directly from the remote database and will not update the local database with results. Results using this policy will also not include any data from the local database - notably any data that has been updated locally but not yet synced. This policy is not avaialble on subscriptions.
- `local-and-remote`: This policy will fetch data from the local database and will fetch results from the remote database in the background and update the local database with those results. Optionally you may provide a `timeout` parameter, which informs Triplit to wait `timeout` milliseconds for the remote result to update the local database.

## Subscribe

Alternatively, you may subscribe to a query. Subscibing to a query will provide continual updates to the query result based on the state of your local database.

If syncing is enabled, subscribing to a query will keep your local database in sync with the remote database.

Starting a subscription is as simple as defining a query and a callback to run when data has updated:

```typescript
const unsubscribe = client.subscribe(
  query,
  (results) => {
    // handle results
  },
  (error) => {
    // handle error
  }
);
```

If a subscription query fails on the server then syncing for that query will stop. However, the subscription will remain active and updates to the local database will still be available. As well, the syncing of other queries will not be impacted. Although you will not recieve updates from the server, updates that you make via [mutations](/mutations) will be sent.
